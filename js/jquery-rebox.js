!function(e){e.rebox=function(t,n){this.settings=e.extend(!0,{},e.rebox.defaults,n),this.$el=t,this.$box=null,this.$items=null,this.idx=0,this.enable()},e.rebox.defaults={theme:"rebox",selector:null,prev:"&lsaquo;",next:"&rsaquo;",loading:"$",close:"&times;",speed:400,zIndex:1e3,cycle:!0,captionAttr:"title",template:"image",templates:{image:function(t,n,s){return e('<img src="'+t.attr("href")+'" class="'+n.theme+'-content" />').load(s)}}},e.rebox.setDefaults=function(t){e.rebox.defaults=e.extend(!0,{},e.rebox.defaults,t)},e.rebox.lookup={i:0},e.extend(e.rebox.prototype,{enable:function(){var e=this;return e.$el.on("click.rebox",e.settings.selector,function(t){t.preventDefault(),e.open(this)})},open:function(t){var n=this;return n.$items=null===n.settings.selector?n.$el:n.$el.find(n.settings.selector),isNaN(t)&&(t=n.$items.index(t)),n.$box=e('<div class="'+n.settings.theme+'" style="display:none;"><a href="#" class="'+n.settings.theme+"-close "+n.settings.theme+'-button">'+n.settings.close+'</a><a href="#" class="'+n.settings.theme+"-prev "+n.settings.theme+'-button">'+n.settings.prev+'</a><a href="#" class="'+n.settings.theme+"-next "+n.settings.theme+'-button">'+n.settings.next+'</a><div class="'+n.settings.theme+'-contents"></div><div class="'+n.settings.theme+'-caption"><p></p></div></div>').appendTo("body").css("zIndex",n.settings.zIndex).fadeIn(n.settings.speed).on("click.rebox","."+n.settings.theme+"-close",function(e){e.preventDefault(),n.close()}).on("click.rebox","."+n.settings.theme+"-next",function(e){e.preventDefault(),n.next()}).on("click.rebox","."+n.settings.theme+"-prev",function(e){e.preventDefault(),n.prev()}).on("click.rebox","."+n.settings.theme+"-contents",function(t){t.preventDefault(),e(t.target).hasClass(n.settings.theme+"-content")&&n.$items.length>1?n.next():n.close()}),e(document).on("swipeLeft.rebox",function(){n.next()}).on("swipeRight.rebox",function(){n.prev()}).on("keydown.rebox",function(e){e.preventDefault();var t=window.event?event.keyCode:e.keyCode;switch(t){case 27:n.close();break;case 37:n.prev();break;case 39:n.next()}}),n.$el.trigger("rebox:open",[n]),n["goto"](t),n.$el},close:function(){var t=this;return t.$box&&t.$box.length&&t.$box.fadeOut(t.settings.speed,function(){t.$box.remove(),t.$box=null,t.$el.trigger("rebox:close",[t])}),e(document).off(".rebox"),t.$el},"goto":function(t){var n=this,s=e(n.$items[t]),i=s.attr(n.settings.captionAttr),o=(n.$box.children("."+n.settings.theme+"-caption")[i?"show":"hide"]().children("p").text(i),n.$box.children("."+n.settings.theme+"-contents")),r=null;return s.length&&(n.idx=t,o.html('<div class="'+n.settings.theme+"-loading "+n.settings.theme+'-button">'+n.settings.loading+"</div>"),r=n.settings.templates[s.data("rebox-template")||n.settings.template](s,n.settings,function(){o.empty().append(e(this))}),1!=n.$items.length&&n.settings.cycle||(n.$box.children("."+n.settings.theme+"-prev")[0>=t?"hide":"show"](),n.$box.children("."+n.settings.theme+"-next")[t>=n.$items.length-1?"hide":"show"]()),n.$el.trigger("rebox:goto",[n,t,s,r])),n.$el},prev:function(){var e=this;return e["goto"](0===e.idx?e.$items.length-1:e.idx-1)},next:function(){var e=this;return e["goto"](e.idx===e.$items.length-1?0:e.idx+1)},disable:function(){var e=this;return e.close().off(".rebox").trigger("rebox:disable",[e])},destroy:function(){var e=this;return e.disable().removeData("rebox").trigger("rebox:destroy")},option:function(e,t){var n=this;return void 0!==t?(n.settings[e]=t,n.disable().enable()):n.settings[e]}}),e.fn.rebox=function(t){t=t||{};var n=Array.prototype.slice.call(arguments);if("string"==typeof t){if("option"==t&&"string"==typeof n[1]&&2===n.length){var s=e.rebox.lookup[e(this).data("rebox")];return s[t].apply(s,n.slice(1))}return this.each(function(){var s=e.rebox.lookup[e(this).data("rebox")];s[t].apply(s,n.slice(1))})}return this.each(function(){var n=e(this);e.rebox.lookup[++e.rebox.lookup.i]=new e.rebox(n,t),n.data("rebox",e.rebox.lookup.i)})}}(window.jQuery||window.Zepto||window.$);